
https://platform.stratascratch.com/coding/10308-salaries-differences?code_type=1

-- assumming all emplyees have department - inner join

select
abs(marketing_sal-engineering_sal) as abs_diff
from (
    select 
    max(case when department ='marketing' then salary else 0 end) as marketing_sal,
    max(case when department ='engineering' then salary else 0 end) as engineering_sal
    from db_employee e
    join db_dept d
    on e.department_id = d.id
    where department in ('marketing','engineering')
)

--use else null instead of 0 because if there are no employees then it will say 0 which is incorrect
--or just skip else completely

Other solutions:

--Very concise
--Scans all departments if table is very large

SELECT
    ABS(
        MAX(CASE WHEN d.department = 'marketing' THEN e.salary END) -
        MAX(CASE WHEN d.department = 'engineering' THEN e.salary END)
    ) AS abs_diff
FROM db_employee e
JOIN db_dept d
  ON e.department_id = d.id;



with cte as (
 select
  t2.department,
  max(t1.salary) as max_salary
 from db_employee t1
 left join db_dept t2 on t1.department_id = t2.id
 group by t2.department
)

select 
abs(
 (select max_salary from cte where department = "marketing" ) - 
 (select max_salary from cte where department = "engineering")
) as salary_difference;
--readable 
-- can be extended to other departments
